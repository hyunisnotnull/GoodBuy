<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <%- include('../include/title.ejs') %>
    <link href="/css/product/list_product_form.css" rel="stylesheet" type="text/css">
    <script src="/js/product/list_product_form.js"></script>
</head>
<body>

    <%- include('../include/header.ejs') %>
    <%- include('../include/nav.ejs') %>
    
    <article>
        <div class="article_wrap">
            <div class="title">
                <h4>SALE PRODUCT LIST</h4>
            </div>
            <div class="content">

                <div class="total_count">
                    <% if (keyword) { %>
                        총 <span id="product_count"><%= totalCount %></span> 건에 대한 "<%= keyword %>" 검색 결과
                    <% } else { %>
                        총 <span id="product_count"><%= totalCount %></span> 건
                    <% } %>
                </div>
                <div class="sort_menu">
                    정렬:
                    <a href="/product/list_sale_product_form">전체</a> |
                    <a href="/product/list_sale_product_form?keyword=<%= keyword %>&sort=latest">최신순</a> |
                    <a href="/product/list_sale_product_form?keyword=<%= keyword %>&sort=price_low">저가순</a> |
                    <a href="/product/list_sale_product_form?keyword=<%= keyword %>&sort=price_high">고가순</a>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>NO</th>
                            <th>NAME</th>
                            <th>PRICE</th>
                            <th>THUM</th>
                            <th>
                                CATEGORY
                                <select name="category" onchange="filterByCategoryForSale(event);">
                                    <% category.forEach(cat => { %>
                                        <option value="<%= cat.C_NO %>" <%= cat.C_NO == currentCategory ? 'selected' : '' %>><%= cat.C_NAME %></option>
                                    <% }); %>
                                </select>
                            </th>
                            <th>ADDRESS</th>
                            <th>OWNER</th>
                            <th>MOD_DATE</th>
                            <th></th>
                        </tr>
                    </thead>
                        <% for (let i = 0; i < products.length; i++) {%>
                            <tr>
                                <td><%= products[i].P_NO %></td>
                                <td><a href="/product/detail_product_form?p_no=<%= products[i].P_NO %>"><%= products[i].P_NAME %></a></td>
                                <td><%= products[i].P_PRICE.toLocaleString() %></td>                             
                                <td><img src="\<%= products[i].P_OWNER_ID %>\<%= products[i].P_IMAGE %>"></td>
                                <td><%= category[parseInt(products[i].P_CATEGORY)].C_NAME %></td>
                                <td><%- products[i].P_ADDRESS.replace(/.*\(/,'').replace(')','') %></td>
                                <td><%= products[i].P_OWNER_NICK %></td>
                                <td><%= products[i].P_MOD_DATE.toISOString().substring(0,10) %></td>
                            </tr>
                        <% }%>
                </table>
                <%- include('../include/pagination_list_product.ejs', {
                    currentPage: pagination.currentPage,
                    totalPages: pagination.totalPages,
                    pageRange: pagination.pageRange,
                    baseUrl: pagination.baseUrl
                }) %>
            </div>
        </div>
    </article>

    <%- include('../include/footer.ejs') %>
</body>
</html>